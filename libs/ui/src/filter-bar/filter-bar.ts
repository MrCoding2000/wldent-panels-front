import {Component, EventEmitter, OnInit, Output} from '@angular/core';
import {I18nService} from "@waldent-panels-front/translate";
import {NgClass} from "@angular/common";
import {FormControl, FormsModule, ReactiveFormsModule} from "@angular/forms";
import {DomSanitizer} from "@angular/platform-browser";
import {debounceTime, distinctUntilChanged, filter} from "rxjs";

@Component({
  selector: 'lib-filter-bar',
  imports: [
    NgClass,
    FormsModule,
    ReactiveFormsModule
  ],
  standalone: true,
  templateUrl: './filter-bar.html',
  styleUrl: './filter-bar.scss'
})
export class FilterBar implements OnInit {
  searchControl = new FormControl('');
  orderFilterNames: any[] = ['newest', 'oldest', 'bestSeller', 'lowestSales'];
  orderFilterActive: 'newest' | 'oldest' | 'bestSeller' | 'lowestSales' = 'newest';
  advancedFilters = [
    {
      icon: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="16" viewBox="0 0 18 16" fill="none">
                <path d="M14.6538 15.6537C13.7169 15.6537 12.925 15.3303 12.278 14.6834C11.6312 14.0364 11.3077 13.2445 11.3077 12.3077C11.3077 11.3707 11.6312 10.5788 12.278 9.93194C12.925 9.28494 13.7169 8.96144 14.6538 8.96144C15.5908 8.96144 16.3827 9.28494 17.0295 9.93194C17.6765 10.5788 18 11.3707 18 12.3077C18 13.2445 17.6765 14.0364 17.0295 14.6834C16.3827 15.3303 15.5908 15.6537 14.6538 15.6537ZM14.6528 14.1537C15.1624 14.1537 15.5977 13.9736 15.9587 13.6134C16.3196 13.2531 16.5 12.8182 16.5 12.3087C16.5 11.799 16.3198 11.3637 15.9595 11.0027C15.5993 10.6419 15.1644 10.4614 14.6547 10.4614C14.1451 10.4614 13.7098 10.6416 13.349 11.0019C12.9882 11.3621 12.8077 11.797 12.8077 12.3067C12.8077 12.8164 12.9878 13.2516 13.348 13.6124C13.7083 13.9733 14.1433 14.1537 14.6528 14.1537ZM8.3655 13.0577H2.25C2.0375 13.0577 1.85942 12.9858 1.71575 12.8419C1.57192 12.6981 1.5 12.5199 1.5 12.3072C1.5 12.0947 1.57192 11.9166 1.71575 11.7729C1.85942 11.6294 2.0375 11.5577 2.25 11.5577H8.3655C8.578 11.5577 8.75608 11.6296 8.89975 11.7734C9.04358 11.9173 9.1155 12.0954 9.1155 12.3079C9.1155 12.5206 9.04358 12.6987 8.89975 12.8422C8.75608 12.9859 8.578 13.0577 8.3655 13.0577ZM3.34625 7.03844C2.40925 7.03844 1.61733 6.71494 0.9705 6.06794C0.3235 5.42111 0 4.62919 0 3.69219C0 2.75536 0.3235 1.96344 0.9705 1.31644C1.61733 0.669608 2.40925 0.346191 3.34625 0.346191C4.28308 0.346191 5.075 0.669608 5.722 1.31644C6.36883 1.96344 6.69225 2.75536 6.69225 3.69219C6.69225 4.62919 6.36883 5.42111 5.722 6.06794C5.075 6.71494 4.28308 7.03844 3.34625 7.03844ZM3.34525 5.53844C3.85492 5.53844 4.29017 5.35827 4.651 4.99794C5.01183 4.63777 5.19225 4.20286 5.19225 3.69319C5.19225 3.18352 5.01217 2.74828 4.652 2.38744C4.29167 2.02661 3.85675 1.84619 3.34725 1.84619C2.83758 1.84619 2.40225 2.02628 2.04125 2.38644C1.68042 2.74678 1.5 3.18169 1.5 3.69119C1.5 4.20086 1.68017 4.63619 2.0405 4.99719C2.40067 5.35803 2.83558 5.53844 3.34525 5.53844ZM15.75 4.44219H9.6345C9.422 4.44219 9.24392 4.37028 9.10025 4.22644C8.95642 4.08261 8.8845 3.90444 8.8845 3.69194C8.8845 3.47928 8.95642 3.30119 9.10025 3.15769C9.24392 3.01403 9.422 2.94219 9.6345 2.94219H15.75C15.9625 2.94219 16.1406 3.01411 16.2843 3.15794C16.4281 3.30178 16.5 3.48003 16.5 3.69269C16.5 3.90519 16.4281 4.08328 16.2843 4.22694C16.1406 4.37044 15.9625 4.44219 15.75 4.44219Z" fill="#222222"/>
            </svg>`,
    },
    {
      icon: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M2.30775 7.81725C1.80258 7.81725 1.375 7.64225 1.025 7.29225C0.675 6.94225 0.5 6.51467 0.5 6.0095V2.30775C0.5 1.80258 0.675 1.375 1.025 1.025C1.375 0.675 1.80258 0.5 2.30775 0.5H15.6923C16.1974 0.5 16.625 0.675 16.975 1.025C17.325 1.375 17.5 1.80258 17.5 2.30775V6.0095C17.5 6.51467 17.325 6.94225 16.975 7.29225C16.625 7.64225 16.1974 7.81725 15.6923 7.81725H2.30775ZM2.30775 6.31725H15.6923C15.7821 6.31725 15.8558 6.28842 15.9135 6.23075C15.9712 6.17308 16 6.09933 16 6.0095V2.30775C16 2.21792 15.9712 2.14417 15.9135 2.0865C15.8558 2.02883 15.7821 2 15.6923 2H2.30775C2.21792 2 2.14417 2.02883 2.0865 2.0865C2.02883 2.14417 2 2.21792 2 2.30775V6.0095C2 6.09933 2.02883 6.17308 2.0865 6.23075C2.14417 6.28842 2.21792 6.31725 2.30775 6.31725ZM2.30775 17.5C1.80258 17.5 1.375 17.325 1.025 16.975C0.675 16.625 0.5 16.1974 0.5 15.6923V12C0.5 11.4948 0.675 11.0673 1.025 10.7172C1.375 10.3672 1.80258 10.1923 2.30775 10.1923H15.6923C16.1974 10.1923 16.625 10.3672 16.975 10.7172C17.325 11.0673 17.5 11.4948 17.5 12V15.6923C17.5 16.1974 17.325 16.625 16.975 16.975C16.625 17.325 16.1974 17.5 15.6923 17.5H2.30775ZM2.30775 16H15.6923C15.7821 16 15.8558 15.9712 15.9135 15.9135C15.9712 15.8558 16 15.7821 16 15.6923V12C16 11.9102 15.9712 11.8364 15.9135 11.7788C15.8558 11.7211 15.7821 11.6923 15.6923 11.6923H2.30775C2.21792 11.6923 2.14417 11.7211 2.0865 11.7788C2.02883 11.8364 2 11.9102 2 12V15.6923C2 15.7821 2.02883 15.8558 2.0865 15.9135C2.14417 15.9712 2.21792 16 2.30775 16Z" fill="#222222"/>
             </svg>`,
    },
    {
      icon: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 18 18" fill="none">
                <path d="M5.69225 7.5H2.30775C1.80258 7.5 1.375 7.325 1.025 6.975C0.675 6.625 0.5 6.19742 0.5 5.69225V2.30775C0.5 1.80258 0.675 1.375 1.025 1.025C1.375 0.675 1.80258 0.5 2.30775 0.5H5.69225C6.19742 0.5 6.625 0.675 6.975 1.025C7.325 1.375 7.5 1.80258 7.5 2.30775V5.69225C7.5 6.19742 7.325 6.625 6.975 6.975C6.625 7.325 6.19742 7.5 5.69225 7.5ZM2.30775 6H5.69225C5.78208 6 5.85583 5.97117 5.9135 5.9135C5.97117 5.85583 6 5.78208 6 5.69225V2.30775C6 2.21792 5.97117 2.14417 5.9135 2.0865C5.85583 2.02883 5.78208 2 5.69225 2H2.30775C2.21792 2 2.14417 2.02883 2.0865 2.0865C2.02883 2.14417 2 2.21792 2 2.30775V5.69225C2 5.78208 2.02883 5.85583 2.0865 5.9135C2.14417 5.97117 2.21792 6 2.30775 6ZM5.69225 17.5H2.30775C1.80258 17.5 1.375 17.325 1.025 16.975C0.675 16.625 0.5 16.1974 0.5 15.6923V12.3077C0.5 11.8026 0.675 11.375 1.025 11.025C1.375 10.675 1.80258 10.5 2.30775 10.5H5.69225C6.19742 10.5 6.625 10.675 6.975 11.025C7.325 11.375 7.5 11.8026 7.5 12.3077V15.6923C7.5 16.1974 7.325 16.625 6.975 16.975C6.625 17.325 6.19742 17.5 5.69225 17.5ZM2.30775 16H5.69225C5.78208 16 5.85583 15.9712 5.9135 15.9135C5.97117 15.8558 6 15.7821 6 15.6923V12.3077C6 12.2179 5.97117 12.1442 5.9135 12.0865C5.85583 12.0288 5.78208 12 5.69225 12H2.30775C2.21792 12 2.14417 12.0288 2.0865 12.0865C2.02883 12.1442 2 12.2179 2 12.3077V15.6923C2 15.7821 2.02883 15.8558 2.0865 15.9135C2.14417 15.9712 2.21792 16 2.30775 16ZM15.6923 7.5H12.3077C11.8026 7.5 11.375 7.325 11.025 6.975C10.675 6.625 10.5 6.19742 10.5 5.69225V2.30775C10.5 1.80258 10.675 1.375 11.025 1.025C11.375 0.675 11.8026 0.5 12.3077 0.5H15.6923C16.1974 0.5 16.625 0.675 16.975 1.025C17.325 1.375 17.5 1.80258 17.5 2.30775V5.69225C17.5 6.19742 17.325 6.625 16.975 6.975C16.625 7.325 16.1974 7.5 15.6923 7.5ZM12.3077 6H15.6923C15.7821 6 15.8558 5.97117 15.9135 5.9135C15.9712 5.85583 16 5.78208 16 5.69225V2.30775C16 2.21792 15.9712 2.14417 15.9135 2.0865C15.8558 2.02883 15.7821 2 15.6923 2H12.3077C12.2179 2 12.1442 2.02883 12.0865 2.0865C12.0288 2.14417 12 2.21792 12 2.30775V5.69225C12 5.78208 12.0288 5.85583 12.0865 5.9135C12.1442 5.97117 12.2179 6 12.3077 6ZM15.6923 17.5H12.3077C11.8026 17.5 11.375 17.325 11.025 16.975C10.675 16.625 10.5 16.1974 10.5 15.6923V12.3077C10.5 11.8026 10.675 11.375 11.025 11.025C11.375 10.675 11.8026 10.5 12.3077 10.5H15.6923C16.1974 10.5 16.625 10.675 16.975 11.025C17.325 11.375 17.5 11.8026 17.5 12.3077V15.6923C17.5 16.1974 17.325 16.625 16.975 16.975C16.625 17.325 16.1974 17.5 15.6923 17.5ZM12.3077 16H15.6923C15.7821 16 15.8558 15.9712 15.9135 15.9135C15.9712 15.8558 16 15.7821 16 15.6923V12.3077C16 12.2179 15.9712 12.1442 15.9135 12.0865C15.8558 12.0288 15.7821 12 15.6923 12H12.3077C12.2179 12 12.1442 12.0288 12.0865 12.0865C12.0288 12.1442 12 12.2179 12 12.3077V15.6923C12 15.7821 12.0288 15.8558 12.0865 15.9135C12.1442 15.9712 12.2179 16 12.3077 16Z" fill="#009975"/>
             </svg>`,
    }
  ];

  @Output() searchValue: EventEmitter<string | null> = new EventEmitter<string | null>()
  @Output() orderFilterValue: EventEmitter<'newest' | 'oldest' | 'bestSeller' | 'lowestSales'> = new EventEmitter<'newest' | 'oldest' | 'bestSeller' | 'lowestSales'>();

  constructor(public i18n: I18nService, public sanitizer: DomSanitizer) {
  }

  ngOnInit() {
    this.controlSearch();
  }

  /**
   * Control Search
   */
  controlSearch() {
    this.searchControl.valueChanges.pipe(
      debounceTime(1000),
      distinctUntilChanged(),
      filter(value => !!value?.trim()),
    ).subscribe((result: string | null) => {
      this.searchValue.emit(result);
    });
  }
}
